{
    "title": "Database/Augur Metrics Dashboard",
    "uid": "database-augur-metrics",
    "templating": {
        "list": [
            {
                "name": "datasource",
                "type": "datasource",
                "query": "prometheus",
                "current": {
                    "value": "Prometheus"
                },
                "hide": 0,
                "label": "Data Source",
                "refresh": 1
            }
        ]
    },
    "panels": [
        {
            "title": "Database Error Rate",
            "type": "stat",
            "gridPos": {
                "x": 0,
                "y": 0,
                "h": 4,
                "w": 4
            },
            "options": {
                "colorMode": "value",
                "graphMode": "none",
                "justifyMode": "auto",
                "orientation": "auto",
                "textMode": "value",
                "reduceOptions": {
                    "calcs": [
                        "rate"
                    ]
                }
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "decimals": 2,
                    "color": {
                        "mode": "thresholds"
                    },
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "value": null,
                                "color": "green"
                            },
                            {
                                "value": 1,
                                "color": "red"
                            }
                        ]
                    }
                }
            },
            "targets": [
                {
                    "expr": "rate(database_errors_total[5m])",
                    "refId": "A",
                    "datasource": "${datasource}"
                }
            ]
        },
        {
            "title": "Total Query Rate",
            "type": "stat",
            "gridPos": {
                "x": 4,
                "y": 0,
                "h": 4,
                "w": 4
            },
            "options": {
                "colorMode": "none",
                "graphMode": "none",
                "justifyMode": "auto",
                "orientation": "auto",
                "textMode": "value",
                "reduceOptions": {
                    "calcs": [
                        "rate"
                    ]
                }
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "queries/sec",
                    "decimals": 2
                }
            },
            "targets": [
                {
                    "expr": "sum(rate(queries_total[5m]))",
                    "legendFormat": "Total QPS",
                    "refId": "A",
                    "datasource": "${datasource}"
                }
            ]
        },
        {
            "title": "Core Collection Status",
            "type": "bargauge",
            "gridPos": {
                "x": 8,
                "y": 0,
                "h": 4,
                "w": 4
            },
            "options": {
                "displayMode": "lcd",
                "orientation": "auto",
                "showThresholdLabels": false,
                "showThresholdMarkers": false
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "mappings": [],
                    "color": {
                        "mode": "palette-classic"
                    }
                }
            },
            "targets": [
                {
                    "expr": "augur_core_repos_success_count",
                    "legendFormat": "Success",
                    "refId": "A",
                    "datasource": "${datasource}"
                },
                {
                    "expr": "augur_core_repos_pending_count",
                    "legendFormat": "Pending",
                    "refId": "B",
                    "datasource": "${datasource}"
                },
                {
                    "expr": "augur_core_repos_error_count",
                    "legendFormat": "Error",
                    "refId": "C",
                    "datasource": "${datasource}"
                }
            ]
        },
        {
            "title": "Secondary Collection Status",
            "type": "bargauge",
            "gridPos": {
                "x": 0,
                "y": 4,
                "h": 4,
                "w": 4
            },
            "options": {
                "displayMode": "lcd",
                "orientation": "auto",
                "showThresholdLabels": false,
                "showThresholdMarkers": false
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "mappings": [],
                    "color": {
                        "mode": "palette-classic"
                    }
                }
            },
            "targets": [
                {
                    "expr": "augur_secondary_repos_success_count",
                    "legendFormat": "Success",
                    "refId": "A",
                    "datasource": "${datasource}"
                },
                {
                    "expr": "augur_secondary_repos_pending_count",
                    "legendFormat": "Pending",
                    "refId": "B",
                    "datasource": "${datasource}"
                },
                {
                    "expr": "augur_secondary_repos_error_count",
                    "legendFormat": "Error",
                    "refId": "C",
                    "datasource": "${datasource}"
                }
            ]
        },
        {
            "title": "Facade Collection Status",
            "type": "bargauge",
            "gridPos": {
                "x": 4,
                "y": 4,
                "h": 4,
                "w": 4
            },
            "options": {
                "displayMode": "lcd",
                "orientation": "auto",
                "showThresholdLabels": false,
                "showThresholdMarkers": false
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "mappings": [],
                    "color": {
                        "mode": "palette-classic"
                    }
                }
            },
            "targets": [
                {
                    "expr": "augur_facade_repos_success_count",
                    "legendFormat": "Success",
                    "refId": "A",
                    "datasource": "${datasource}"
                },
                {
                    "expr": "augur_facade_repos_pending_count",
                    "legendFormat": "Pending",
                    "refId": "B",
                    "datasource": "${datasource}"
                },
                {
                    "expr": "augur_facade_repos_error_count",
                    "legendFormat": "Error",
                    "refId": "C",
                    "datasource": "${datasource}"
                }
            ]
        },
        {
            "title": "Query Latency Heatmap",
            "type": "heatmap",
            "gridPos": {
                "x": 8,
                "y": 4,
                "h": 8,
                "w": 4
            },
            "options": {
                "ySplit": "query"
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "s"
                }
            },
            "targets": [
                {
                    "expr": "sum(rate(query_latency_bucket[5m])) by (le, query)",
                    "legendFormat": "{{query}} le={{le}}",
                    "refId": "A",
                    "datasource": "${datasource}"
                }
            ]
        },
        {
            "title": "Queries Per Second (QPS) by Query Type",
            "type": "timeseries",
            "gridPos": {
                "x": 0,
                "y": 8,
                "h": 8,
                "w": 6
            },
            "options": {
                "legend": {
                    "show": true
                }
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "queries/sec",
                    "custom": {
                        "drawStyle": "line"
                    }
                }
            },
            "targets": [
                {
                    "expr": "sum(rate(queries_total{status=\"success\"}[5m])) by (query)",
                    "legendFormat": "{{query}}",
                    "refId": "A",
                    "datasource": "${datasource}"
                }
            ]
        },
        {
            "title": "Query Latency (P50/P90)",
            "type": "timeseries",
            "gridPos": {
                "x": 6,
                "y": 8,
                "h": 8,
                "w": 6
            },
            "options": {
                "legend": {
                    "show": true
                }
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "s",
                    "custom": {
                        "drawStyle": "line"
                    }
                }
            },
            "targets": [
                {
                    "expr": "histogram_quantile(0.50, sum(rate(query_latency_bucket[5m])) by (le, query))",
                    "legendFormat": "{{query}} P50",
                    "refId": "A",
                    "datasource": "${datasource}"
                },
                {
                    "expr": "histogram_quantile(0.90, sum(rate(query_latency_bucket[5m])) by (le, query))",
                    "legendFormat": "{{query}} P90",
                    "refId": "B",
                    "datasource": "${datasource}"
                }
            ]
        }
    ]
}